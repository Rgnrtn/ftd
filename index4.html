<!DOCTYPE HTML>
<!--
	Polaris by Pixelarity
	pixelarity.com @pixelarity
	License: pixelarity.com/license
-->
<html>
	<head>
		<title> </title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
		<script src="js/jquery.min.js"></script>
		<script src="js/jquery.dropotron.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-layers.min.js"></script>
		<script src="js/init.js"></script>
		<script src="js/jquery-ui.min.js"></script>

		<noscript>
			<link rel="stylesheet" href="css/skel.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/updates.css" />
			<link rel="stylesheet" href="css/reset.css">
  			<link rel="stylesheet" href="css/style_loding.css" />
		</noscript>
		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
		<!--
		<script type="text/javascript">
			$(document).ready(function()
			{
				$('span#test1').click(function()
				{
					window.location.href="http://baidu.com";
				});
			});
		</script>
		-->
		<style type='text/css'>
		.conctinput{width: 560px;height: 120px;border: 1px solid rgb(204, 204, 204);margin-top: 15px;box-shadow: rgb(234, 234, 234) 1px 1px 1px 0px inset;background-color: #fff;border-radius:3px;padding: 5px;}

.concttarea{width: 558px;height: 118px;border: 0px;background-color: rgba(0, 0, 0, 0);margin: 2px 0 0 2px;outline: 0px;font-size: 14px;resize:none;}
.conctbom{width: 560px;height: 35px;}
.conctbleft{width: 390px;height: 16px;padding-top: 10px;float: left;}
.conctbul{width: 390px;height: 16px;}
.conctbli{width: 60px;height: 16px;float:left; }
.conctbtxt{color: rgb(51, 51, 51);line-height: 16px;height: 16px;display: inline-block;float: left;}
.conctbicobox{width: 16px;height: 16px;display: block;float: left;padding-right: 5px;}

.conctbrfb{width: 80px;height: 29px;border:1px solid rgb(217, 217, 217);background-color: rgb(242, 242, 242);border-radius: 2px;display:block;float: right;text-align: center;cursor: pointer;}
div#alert1
{
	position:absolute;
	top:800px;
	right:0px;
	height:60px;
	width:260px;
	background-color: #ea7118;
	color:white;
	padding: 20px;
	font-size: 18px;
}
div#alert2
{
	position:absolute;
	top:900px;
	right:0px;
	height:60px;
	width:260px;
	background-color: #ea7118;
	color:white;
	padding: 20px;
	font-size: 18px;
}
		</style>

	 	<script type="text/javascript">
	 	
	 		$(document).ready(function(){
	 			function displayalert1(x)
		{
			$('div#alert1').fadeIn();
			$('div#alert1').text(x);
			setTimeout("$('div#alert1').fadeOut();",2000);
		}
		function displayalert2(x)
		{
			$('div#alert2').fadeIn();
			$('div#alert2').text(x);
			setTimeout("$('div#alert2').fadeOut();",2000);
		}
		$('div#alert1').hide();
		$('div#alert2').hide();
	 			var currUrl = document.URL;
	 			document.getElementById("weibo_login_or_get").href = "/weibo_callback";


	 			  // This is called with the results from from FB.getLoginStatus().
	  function statusChangeCallback(response) {
	    console.log('statusChangeCallback');
	    console.log(response);
	    // The response object is returned with a status field that lets the
	    // app know the current login status of the person.
	    // Full docs on the response object can be found in the documentation
	    // for FB.getLoginStatus().
	    if (response.status === 'connected') {
	      // Logged into your app and Facebook. 
	      // pass access token to server. 
	      console.log(response.authResponse.accessToken);
	      sendToken(response.authResponse.accessToken);
	      getMsg();
	      testAPI();
	    } else if (response.status === 'not_authorized') {
	      // The person is logged into Facebook, but not your app.
	      document.getElementById('status').innerHTML = 'Please log ' +
	        'into this app.';
	    } else {
	      // The person is not logged into Facebook, so we're not sure if
	      // they are logged into this app or not.
	      document.getElementById('status').innerHTML = 'Please log ' +
	        'into Facebook.';
	    }
	  }
	
	  // This function is called when someone finishes with the Login
	  // Button.  See the onlogin handler attached to it in the sample
	  // code below.
	  function checkLoginState() {
	    FB.getLoginStatus(function(response) {
	      statusChangeCallback(response);
	    });
	    // getMsg();
	  }
	
	  window.fbAsyncInit = function() {
	  FB.init({
	    appId      : '402869429886718',
	    cookie     : true,  // enable cookies to allow the server to access 
	                        // the session
	    xfbml      : true,  // parse social plugins on this page
	    version    : 'v2.1' // use version 2.1
	  });
	
	  // Now that we've initialized the JavaScript SDK, we call 
	  // FB.getLoginStatus().  This function gets the state of the
	  // person visiting this page and can return one of three states to
	  // the callback you provide.  They can be:
	  //
	  // 1. Logged into your app ('connected')
	  // 2. Logged into Facebook, but not your app ('not_authorized')
	  // 3. Not logged into Facebook and can't tell if they are logged into
	  //    your app or not.
	  //
	  // These three cases are handled in the callback function.
	
	  FB.getLoginStatus(function(response) {
	    statusChangeCallback(response);
	  });
	
	  };
	
	  // Load the SDK asynchronously
	  (function(d, s, id) {
	    var js, fjs = d.getElementsByTagName(s)[0];
	    if (d.getElementById(id)) return;
	    js = d.createElement(s); js.id = id;
	    js.src = "//connect.facebook.net/en_US/sdk.js";
	    fjs.parentNode.insertBefore(js, fjs);
	  }(document, 'script', 'facebook-jssdk'));
	
	  // Here we run a very simple test of the Graph API after login is
	  // successful.  See statusChangeCallback() for when this call is made.
	  function testAPI() {
	    console.log('Welcome!  Fetching your information.... ');
	    FB.api('/me/permissions', function(response) {
	      console.log('Successful login for: ' + response.data);
	      console.log(response);
	      /*
	      document.getElementById('status').innerHTML =
	        'Thanks for logging in, ' + response.data + '!';
			*/
	    });
	  }
	  
	  function postMsg(data) {
	  		/* make the API call */
		FB.api(
		    "/me/feed",
		    "POST",
		    {
		        "message": data
		    },
		    function (response) {
		      if (response && !response.error) {
		        /* handle the result */
		        displayalert1("Successfully post on facebook");
		        getMsg();
		        console.log(response);
		      }
		    }
		);
	  }
	  function getMsg() {
	  		/* make the API call */
		FB.api(
		    "/me/feed",
		    function (response) {

		      if (response && !response.error) {
		        /* handle the result */
		        //console.log(response);
		        var htmlCode = '';
		        console.log(response.data);
		        var j=0;
		        for (var i = 0; i < response.data.length; i++) {
		        	if (response.data[i].message) {
		        		j++;
			        	if (j==1)
			        	{
			        		$('#facebook_content_1').text(response.data[i].message);
			        		$('#facebook_time_1').text(response.data[i].created_time);
			        		$('#facebook_name_1').text(response.data[i].from.name)
			        	}
			        	if (j==2)
			        	{
			        		$('#facebook_content_2').text(response.data[i].message);
			        		$('#facebook_time_2').text(response.data[i].created_time);
			        		$('#facebook_name_2').text(response.data[i].from.name)
			        		break;
			        	}
		        	}
		        }
		      }
		    }
		);
	  }
	  function sendweibo(text)
	  {
	  	console.log(text);
	  	$.getJSON( "/weibo_update?text=" + text, function(data){
	  		$.getJSON( "/weibo_home?access_token=2.00bFo2AGfagwYCc4a389cecf0YeBKE",function( data ) {
				$('#weibo_name_1').text(data["statuses"][0]["user"]["name"]);
					$('#weibo_name_2').text(data["statuses"][1]["user"]["name"]);
					$('#weibo_time_1').text(data["statuses"][0]["created_at"].substring(0,19));
					$('#weibo_time_2').text(data["statuses"][1]["created_at"].substring(0,19));
					$('#weibo_content_1').text(data["statuses"][0]["text"]);
					$('#weibo_content_2').text(data["statuses"][1]["text"]);
				});
	  	});
	  	
	  	displayalert2("Successfully post a weibo");
	  }
	  function sendToken(access_token) {
		  var xmlhttp;
		  if (window.XMLHttpRequest)
		    {// code for IE7+, Firefox, Chrome, Opera, Safari
		    xmlhttp=new XMLHttpRequest();
		    }
		  else
		    {// code for IE6, IE5
		    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
		    }
		  xmlhttp.onreadystatechange=function()
		    {
		    if (xmlhttp.readyState==4 && xmlhttp.status==200)
		      {
		      console.log(xmlhttp.responseText); // login success
		      }
		    }
		  xmlhttp.open("POST","facebook_token",true);
		  
		  xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		  xmlhttp.send("access_token=" + access_token);
	  }
	  		choice1=0;choice2=0;choice3=0;
	  			$('span#choice1').click(function()
	  			{
	  				if (choice1==0)
	  				{
	  					choice1=1;
	  					$(this).css({"border":"1px solid green"});
	  				}
	  				else
	  				{
	  					choice1=0;
	  					$(this).css({"border":"0px"});
	  				}
	  			});
	  			$('span#choice2').click(function()
	  			{
	  				if (choice2==0)
	  				{
	  					choice2=1;
	  					$(this).css({"border":"1px solid green"});
	  				}
	  				else
	  				{
	  					choice2=0;
	  					$(this).css({"border":"0px"});
	  				}
	  			});

	  			$('span#choice3').click(function()
	  			{
	  				if (choice3==0)
	  				{
	  					choice3=1;
	  					$(this).css({"border":"1px solid green"});
	  				}
	  				else
	  				{
	  					choice3=0;
	  					$(this).css({"border":"0px"});
	  				}
	  			});
	  			$('div#post1').click(function()
	  			{
	  				if (choice1)
	  				{
	  					postMsg($('#input1').val());
	  				}
	  				if (choice3)
	  				{
	  					sendweibo($('#input1').val());
	  				}
	  			});
				$(".objectDrag").draggable({helper:'clone'});  
				$(".objectDrop").droppable({
					accept: ".objectDrag",
					drop: function(event,ui){
							console.log("Item was Dropped");
							//$(this).append($(ui.draggable).clone());
							if ($(this).attr('id')=='facebook')
							{
								
								postMsg($(ui.draggable).children().first().next().next().text());
							}
  					}
				});

				$.getJSON( "/weibo_home?access_token=2.00bFo2AGfagwYCc4a389cecf0YeBKE",function( data ) {
					$('#weibo_name_1').text(data["statuses"][0]["user"]["name"]);
 					$('#weibo_name_2').text(data["statuses"][1]["user"]["name"]);
 					$('#weibo_time_1').text(data["statuses"][0]["created_at"].substring(0,19));
 					$('#weibo_time_2').text(data["statuses"][1]["created_at"].substring(0,19));
 					$('#weibo_content_1').text(data["statuses"][0]["text"]);
 					$('#weibo_content_2').text(data["statuses"][1]["text"]);
 				});
				
				$.getJSON( "/fetch_tweets",function( data ) {
					console.log(data);
					$('#twitter_name_1').text(data[0].user["name"]);
 					$('#twitter_name_2').text(data[1].user["name"]);
 					$('#twitter_time_1').text(data[0]["created_at"].substring(0,19));
 					$('#twitter_time_2').text(data[1]["created_at"].substring(0,19));
 					$('#twitter_content_1').text(data[0]["text"]);
 					$('#twitter_content_2').text(data[1]["text"]);
 				});
			});
	 	</script>
	</head>
	<div id="logo"></div>
	<body class="homepage">
		<!-- Header -->
			<div id="header">
				<div class="container">

					<!-- Logo -->
						<div id="logo">
							<span class="pennant"><span class="icon fa-rocket"></span></span>
							<h1><a href="index.html">For The Dream</a></h1>
						</div>
					<!-- /Logo -->
					
					<!-- Nav -->
						<nav id="nav">
							<ul>
								<li class="active"><a href="index.html">Homepage</a></li>
	
								<li><a href="contact.html">Contact Us</a></li>
							</ul>
						</nav>
					<!-- /Nav -->

				</div>
			</div>
		<!-- /Header -->
			
		<!-- Banner -->
			<div id="banner">
				<div class="container">
					<section>
						<header>
							<h2>Social Media Connector</h2>
							<span class="byline">Connect weibo facebook and twitter.</span>
						</header>
					</section>
				</div>
			</div>
		<!-- /Banner -->

		<!-- Featured -->
			<div id="featured">
				<section class="container">
					<header>
						<h2>For The Dream</h2>
						<span class="byline">KL JNX DLP HMZ, all from usc</span>
					</header>
					<div class="row">
						<section class="4u">
							<ul class="style1">
								<li>
									<span class="left"><span class="icon icon fa-facebook"></span></span>
									<!--
									<fb:login-button scope="public_profile,email" onlogin="checkLoginState();">
									</fb:login-button>
									-->
									<span id='login' class="right btn btn-primary">facebook</span>
								</li>
							</ul>
						</section>
						<section class="4u">
							<ul class="style1">
								<li>
									<span class="left"><span class="icon icon fa-weibo"></span></span>
									<a id="weibo_login_or_get" href=""><span class="right">weibo</span></a>
								</li>
							</ul>
						</section>
						<section class="4u">
							<ul class="style1">
								<li>
									<span class="left"><span class="icon icon fa-twitter"></span></span>
									<span class="right">twitter</span>
								</li>
							</ul>
						</section>
					</div>
				</section>
			</div>
		<!-- /Featured -->

		<!-- Main -->
			<div id="main">
			
				<section class="container">
					<header>
					<div class="conctinput"> 
						<textarea id='input1' class="concttarea" placeholder="What's new?"></textarea>
					</div>
					<div class="conctbom">
						<div class="conctbleft">
							<ul class="conctbul">
								<li class="conctbli">
									<span class="conctbicobox">
										<b class="conctbico conctbico1"></b>
									</span>
									<span class="conctbtxt icon icon fa-facebook" id='choice1'></span>
								</li>
								<li class="conctbli">
									<span class="conctbicobox">
										<b class="conctbico conctbico2"></b>
									</span>
									<span class="conctbtxt icon icon fa-twitter" id='choice2'></span>
								</li>
								<li class="conctbli">
									<span class="conctbicobox">
										<b class="conctbico conctbico3"></b>
									</span>
									<span class="conctbtxt icon icon fa-weibo" id="choice3"></span>
								</li>
					
							</ul>
						</div>
						<div class="conctbright">
							
							<div class="conctbrfb" style="margin-top:5px" id='post1'>
								<span>Post</span>
							</div>

						</div>
						<div style="position:absolute;background:url('images/logo.jpg');right:75px;top:150px;height:150px;width:475px"/>
					</header>
					
					<div class="row">
					<section class="4u objectDrop" id="facebook">
						<section>
							<div class="box objectDrag">
								<a href="#" class="button-alt icon fa-facebook-square" id="facebook_name_1"></a>
								<br/>
								<a href="" class="concwbrbltime icon fa-clock-o" id="facebook_time_1"></a>

								<p id="facebook_content_1"></p>

							</div>
						</section>
						<section>
							<div class="box objectDrag">
								<a href="#" class="button-alt icon fa-facebook-square" id="facebook_name_2"></a>	
								<br/>			
								<a href="" class="concwbrbltime icon fa-clock-o" id="facebook_time_2"></a>
								<p id="facebook_content_2"></p>
							</div>
						</section>
						
					</section>
					
					<div class="4u objectDrop" id="weibo">
						<section>
							<div class="box objectDrag">
								<a href="#" class="button-alt icon fa-weibo" id="weibo_name_1"></a>
								<a href="" class="concwbrbltime icon fa-clock-o" id="weibo_time_1"></a>
								<p id="weibo_content_1"></p>
							</div>
						</section>
						<section>
							<div class="box objectDrag">
								<a href="#" class="button-alt icon fa-weibo" id="weibo_name_2"></a>
								<a href="" class="concwbrbltime icon fa-clock-o" id="weibo_time_2"></a>
								<p id="weibo_content_2"></p>

							</div>
						</section>
					</div>
					<section class="4u objectDrop" id="twitter">
						<section>
							<div class="box objectDrag">
								<a href="#" class="button-alt icon fa-twitter-square" id="twitter_name_1">test messager</a>
								<a href="" class="concwbrbltime icon fa-clock-o" id="twitter_time_1"></a>
								<p id="twitter_content_1">test message</p>
							</div>
						</section>
						<section>
							<div class="box objectDrag">
								<a href="#" class="button-alt icon fa-twitter-square" id="twitter_name_2"></a>
								<a href="" class="concwbrbltime icon fa-clock-o" id="twitter_time_2"></a>

								<p id="twitter_content_2"></p>	

							</div>
						</section>
					</section>
					</div>
				</section>
			</div>
		<!-- /Main -->

		<!-- Footer -->
			<div id="footer">
				

					<!-- Copyright -->
						<div class="copyright">
							&copy; Untitled. All rights reserved. Lorem ipsum dolor sit amet nullam feugiat consequat dolore.
						</div>
				</div>
			</div>
		<!-- /Footer -->
		<div id='alert1'></div>
		<div id='alert2'></div>
	</body>
</html>